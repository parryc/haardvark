extends layout-col

block titlepart
	| History - #{name}

block username
	| #{username}

block location
	| #{name} - History


block page-scripts
	script 
		$(document).ready(function(){
			var socket = io.connect('/');
			var groupname = "#{group}";
			var username= "#{username}";
			var maxPos = #{historyLength};
			window.docname = "#{name}"; // until a better solution is found for passing this info to the whiteboard

			$( "#slider" ).change(function(){
				var pos = logslider($('#slider').val());
				pos = maxPos-pos;
				socket.emit('history-lookup',{pos: pos, doc: window.docname});
			});	

			socket.on('history-lookedup',function(data){
				$('#history-text').val(data.text);
				$('#date').html(data.date);
			});
		});

		function logslider(position) {
			// position will be between 0 and 100
			var minp = 0;
			var maxp = 100;

			// The result are between 0 and the number of history revisions
			//Todo: Shit, gotta reverse this data, oh well. 
			var minv = Math.log(1);
			var maxv = Math.log(#{historyLength});

			// calculate adjustment factor
			var scale = (maxv-minv) / (maxp-minp);

			return Math.floor(Math.exp(minv + scale*(position-minp)));
		}
block page-styles

block breadcrumbs
	span.divider
		>
	a(href="/groups/#{group}")
		img(src="/images/breadcrumbs/groups.png").breadcrumbicon
	span.divider
		>
	a(href="/editor/#{group}/#{name}")
		img(src="/images/breadcrumbs/doc.png").breadcrumbicon
	span.divider
		>
	a(href="/editor/#{group}/#{name}/viewhistory")
		img(src="/images/breadcrumbs/history.png").breadcrumbicon

block members
	div
		.column-menu.no-select#members Members
			span.chevron
				i.icon-chevron-up
				i.icon-chevron-down
		a(href="#add-member",style="margin-top: -22px").btn.btn-small.pull-right#add-member-link
			i.icon-plus
			
		.column-content
			each member in members
				div(style="background: #{member.color}").color-div
				| #{member.username}
				br
block duedates
	
block chatbox


block content
	h1.no-select#group-title History
		
	.container-fluid
		.row-fluid
			.span10
				form#history
					textarea(rows="30",style="width: 500px")#history-text
				input(type="range",min="0",max="100",value="0",style="width: 500px")#slider
				br
				| Date: 
				#date
				br
				#revertbutton
					a(href="").btn
						i.icon-refresh 
						| Revert